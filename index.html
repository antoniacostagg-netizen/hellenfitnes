<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hellen Moda Fitness</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset e estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #e91e63;
            --secondary-color: #9c27b0;
            --background-color: #f5f5f5;
            --text-color: #333;
            --light-gray: #eee;
            --medium-gray: #ccc;
            --dark-gray: #666;
            --white: #fff;
            --black: #000;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header */
        header {
            background-color: var(--white);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            max-height: 60px;
            max-width: 200px;
        }
        
        .header-icons {
            display: flex;
            gap: 15px;
        }
        
        .icon-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-color);
            cursor: pointer;
            padding: 5px;
        }
        
        .info-banner {
            background-color: var(--primary-color);
            color: var(--white);
            text-align: center;
            padding: 10px;
            font-size: 0.9rem;
        }
        
        /* Menu lateral */
        .side-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: var(--white);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 101;
            padding: 20px;
        }
        
        .side-menu.active {
            right: 0;
        }
        
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: none;
        }
        
        .menu-overlay.active {
            display: block;
        }
        
        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .menu-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .menu-list {
            list-style: none;
        }
        
        .menu-list li {
            margin-bottom: 15px;
        }
        
        .menu-list a {
            text-decoration: none;
            color: var(--text-color);
            font-size: 1.1rem;
            display: block;
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .menu-list a:hover {
            background-color: var(--light-gray);
        }
        
        /* Catálogo de produtos */
        .products-section {
            padding: 30px 0;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
            color: var(--primary-color);
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .product-card {
            background-color: var(--white);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .product-image {
            position: relative;
            width: 100%;
            height: 250px;
            overflow: hidden;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }
        
        .product-thumbnails {
            display: flex;
            justify-content: center;
            padding: 10px;
            gap: 5px;
        }
        
        .thumbnail {
            width: 50px;
            height: 50px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 5px;
        }
        
        .thumbnail.active {
            border-color: var(--primary-color);
        }
        
        .product-info {
            padding: 15px;
        }
        
        .product-name {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .product-price {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .buy-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            width: 100%;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        .buy-btn:hover {
            background-color: var(--secondary-color);
        }
        
        /* Modal de produto */
        .product-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 102;
            display: none;
        }
        
        .product-modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--white);
            width: 90%;
            max-width: 800px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.5);
            color: var(--white);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1;
        }
        
        .modal-body {
            display: flex;
            flex-direction: column;
        }
        
        @media (min-width: 768px) {
            .modal-body {
                flex-direction: row;
            }
        }
        
        .modal-images {
            flex: 1;
            position: relative;
        }
        
        .image-slider {
            width: 100%;
            height: 400px;
            overflow: hidden;
            position: relative;
        }
        
        .slider-container {
            display: flex;
            width: 300%;
            height: 100%;
            transition: transform 0.5s ease;
        }
        
        .slider-image {
            width: 33.333%;
            height: 100%;
            object-fit: cover;
        }
        
        .slider-nav {
            position: absolute;
            bottom: 15px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
        }
        
        .slider-dot.active {
            background-color: var(--white);
        }
        
        .modal-details {
            flex: 1;
            padding: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .modal-price {
            font-size: 1.3rem;
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .color-options {
            margin-bottom: 20px;
        }
        
        .color-title {
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .color-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: var(--light-gray);
            border-radius: 5px;
        }
        
        .color-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .color-sample {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid var(--medium-gray);
        }
        
        .color-name {
            font-weight: bold;
        }
        
        .color-stock {
            font-size: 0.9rem;
            color: var(--dark-gray);
        }
        
        .quantity-input {
            width: 60px;
            padding: 5px;
            border: 1px solid var(--medium-gray);
            border-radius: 3px;
            text-align: center;
        }
        
        .add-to-cart-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 15px;
            border-radius: 5px;
            width: 100%;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .add-to-cart-btn:hover {
            background-color: var(--secondary-color);
        }
        
        /* Botão flutuante */
        .floating-cart-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 99;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--error);
            color: var(--white);
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* Carrinho */
        .cart-modal {
            position: fixed;
            top: 0;
            right: -400px;
            width: 100%;
            max-width: 400px;
            height: 100%;
            background-color: var(--white);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 103;
            display: flex;
            flex-direction: column;
        }
        
        .cart-modal.active {
            right: 0;
        }
        
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .cart-title {
            font-size: 1.5rem;
        }
        
        .cart-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .cart-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .cart-item-color {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-bottom: 5px;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            background: none;
            border: 1px solid var(--medium-gray);
            width: 25px;
            height: 25px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .cart-item-price {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .cart-remove {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            margin-left: 10px;
        }
        
        .cart-footer {
            padding: 20px;
            border-top: 1px solid var(--light-gray);
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .checkout-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 15px;
            border-radius: 5px;
            width: 100%;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .checkout-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .min-order-warning {
            background-color: var(--warning);
            color: var(--white);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        /* Checkout */
        .checkout-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 104;
            display: none;
        }
        
        .checkout-modal.active {
            display: flex;
        }
        
        .checkout-content {
            background-color: var(--white);
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .checkout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .checkout-title {
            font-size: 1.5rem;
        }
        
        .checkout-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .checkout-body {
            padding: 20px;
        }
        
        .checkout-items {
            margin-bottom: 20px;
        }
        
        .checkout-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .checkout-total {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding-top: 10px;
            border-top: 1px solid var(--light-gray);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-note {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-top: 5px;
        }
        
        .submit-order-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 15px;
            border-radius: 5px;
            width: 100%;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-top: 20px;
        }
        
        .submit-order-btn:hover {
            background-color: var(--secondary-color);
        }
        
        /* Footer */
        footer {
            background-color: var(--white);
            padding: 30px 0;
            margin-top: 50px;
            border-top: 1px solid var(--light-gray);
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        @media (min-width: 768px) {
            .footer-content {
                flex-direction: row;
                justify-content: space-between;
            }
        }
        
        .footer-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .footer-section p, .footer-section a {
            margin-bottom: 10px;
            display: block;
            color: var(--text-color);
            text-decoration: none;
        }
        
        .footer-section a:hover {
            color: var(--primary-color);
        }
        
        .admin-access {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--light-gray);
        }
        
        .admin-link {
            color: var(--dark-gray);
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .admin-link:hover {
            color: var(--primary-color);
        }
        
        /* Painel de administrador */
        .admin-panel {
            display: none;
            padding: 30px 0;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .admin-title {
            font-size: 1.8rem;
            color: var(--primary-color);
        }
        
        .admin-logout {
            background-color: var(--error);
            color: var(--white);
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .admin-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .admin-tab.active {
            border-bottom-color: var(--primary-color);
            font-weight: bold;
        }
        
        .admin-content {
            display: none;
        }
        
        .admin-content.active {
            display: block;
        }
        
        .admin-form {
            background-color: var(--white);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-col {
            flex: 1;
            min-width: 200px;
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .color-input {
            width: 50px;
            height: 30px;
            border: 1px solid var(--medium-gray);
            border-radius: 3px;
            cursor: pointer;
        }
        
        .admin-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .admin-btn.secondary {
            background-color: var(--dark-gray);
        }
        
        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .inventory-table th, .inventory-table td {
            border: 1px solid var(--medium-gray);
            padding: 10px;
            text-align: left;
        }
        
        .inventory-table th {
            background-color: var(--light-gray);
        }
        
        .stock-input {
            width: 80px;
            padding: 5px;
            border: 1px solid var(--medium-gray);
            border-radius: 3px;
        }
        
        .save-stock-btn {
            background-color: var(--success);
            color: var(--white);
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        /* Login */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 105;
        }
        
        .login-content {
            background-color: var(--white);
            width: 90%;
            max-width: 400px;
            border-radius: 10px;
            padding: 30px;
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .login-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 12px;
            border-radius: 5px;
            width: 100%;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            margin-top: 15px;
        }
        
        /* Mensagens */
        .message {
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .message.success {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }
        
        .message.error {
            background-color: rgba(244, 67, 54, 0.2);
            color: var(--error);
            border: 1px solid var(--error);
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .header-top {
                padding: 10px 0;
            }
            
            .logo {
                max-height: 50px;
            }
            
            .icon-btn {
                font-size: 1.3rem;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .modal-body {
                flex-direction: column;
            }
            
            .image-slider {
                height: 300px;
            }
            
            .cart-modal {
                max-width: 100%;
            }
            .admin-access .fa-cog {
                    font-size: 1.2rem;
                    color: #666;
                    transition: color 0.3s;
                }
                
                .admin-access .fa-cog:hover {
                    color: var(--primary-color);
                }

            
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-top">
                <!-- Logo - Pode ser modificada no painel administrativo -->
                <img src="https://via.placeholder.com/200x60?text=HELLEN+MODA+FITNESS" alt="Hellen Moda Fitness" class="logo" id="site-logo">
                
                <div class="header-icons">
                    <!-- Ícone de início -->
                    <button class="icon-btn" id="home-btn">
                        <i class="fas fa-home"></i>
                    </button>
                    
                    <!-- Ícone de menu -->
                    <button class="icon-btn" id="menu-btn">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <!-- Ícone de carrinho -->
                    <button class="icon-btn" id="cart-btn">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-badge" id="cart-badge">0</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Banner informativo -->
        <div class="info-banner">
            Escolha seu produto e seu pedido será enviado via WhatsApp.
        </div>
    </header>
    
    <!-- Menu lateral -->
    <div class="menu-overlay" id="menu-overlay"></div>
    <div class="side-menu" id="side-menu">
        <div class="menu-header">
            <h2>Menu</h2>
            <button class="menu-close" id="menu-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <ul class="menu-list">
            <li><a href="#" data-category="all">Todos os produtos</a></li>
            <li><a href="#" data-category="conjuntos">Conjuntos</a></li>
            <li><a href="#" data-category="macaquinhos">Macaquinhos</a></li>
            <li><a href="#" data-category="tops">Tops</a></li>
            <li><a href="#" data-category="shorts">Shorts</a></li>
        </ul>
    </div>
    
    <!-- Conteúdo principal -->
    <main>
        <section class="products-section">
            <div class="container">
                <h2 class="section-title" id="category-title">Todos os produtos</h2>
                
                <!-- Grid de produtos -->
                <div class="products-grid" id="products-grid">
                    <!-- Os produtos serão carregados dinamicamente aqui -->
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Contato</h3>
                    <p id="footer-phone">Telefone: (11) 99999-9999</p>
                    <p id="footer-email">Email: contato@hellenmodafitness.com</p>
                </div>
                
                <div class="footer-section">
                    <h3>Redes Sociais</h3>
                    <a href="#" id="footer-instagram">Instagram</a>
                    <a href="#" id="footer-facebook">Facebook</a>
                </div>
                
                <div class="footer-section">
                    <h3>Informações</h3>
                    <p>Pedido mínimo: 10 peças</p>
                    <p>Entregamos para todo o Brasil</p>
                </div>
            </div>
            
            <!-- Link para área administrativa (discreto) -->
            <div class="admin-access">
                <a href="#" class="admin-link" id="admin-access-link" title="Acesso administrativo">
                    <i class="fas fa-dice"></i>
                </a>
            </div>
        </div>
    </footer>
    
    <!-- Botão flutuante do carrinho -->
    <button class="floating-cart-btn" id="floating-cart-btn">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-badge" id="floating-cart-badge">0</span>
    </button>
    
    <!-- Modal de produto -->
    <div class="product-modal" id="product-modal">
        <div class="modal-content">
            <button class="modal-close" id="product-modal-close">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="modal-body">
                <div class="modal-images">
                    <div class="image-slider">
                        <div class="slider-container" id="product-slider">
                            <!-- As imagens serão carregadas dinamicamente -->
                        </div>
                    </div>
                    
                    <div class="slider-nav" id="slider-nav">
                        <!-- Os pontos de navegação serão carregados dinamicamente -->
                    </div>
                </div>
                
                <div class="modal-details">
                    <h2 class="modal-title" id="modal-product-name">Nome do Produto</h2>
                    <p class="modal-price" id="modal-product-price">R$ 0,00</p>
                    
                    <div class="color-options" id="color-options">
                        <!-- As opções de cor serão carregadas dinamicamente -->
                    </div>
                    
                    <button class="add-to-cart-btn" id="add-to-cart-btn">Adicionar ao Carrinho</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Carrinho -->
    <div class="cart-modal" id="cart-modal">
        <div class="cart-header">
            <h2 class="cart-title">Carrinho</h2>
            <button class="cart-close" id="cart-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-items" id="cart-items">
            <!-- Os itens do carrinho serão carregados dinamicamente -->
        </div>
        
        <div class="cart-footer">
            <div class="min-order-warning">
                Pedido mínimo: 10 peças
            </div>
            
            <div class="cart-total">
                <span>Total:</span>
                <span id="cart-total">R$ 0,00</span>
            </div>
            
            <button class="checkout-btn" id="checkout-btn">Finalizar Compra</button>
        </div>
    </div>
    
    <!-- Checkout -->
    <div class="checkout-modal" id="checkout-modal">
        <div class="checkout-content">
            <div class="checkout-header">
                <h2 class="checkout-title">Finalizar Pedido</h2>
                <button class="checkout-close" id="checkout-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="checkout-body">
                <div class="checkout-items" id="checkout-items">
                    <!-- Os itens do pedido serão carregados dinamicamente -->
                </div>
                
                <div class="checkout-total">
                    <span>Total:</span>
                    <span id="checkout-total">R$ 0,00</span>
                </div>
                
                <form id="checkout-form">
                    <div class="form-group">
                        <label class="form-label" for="customer-name">Nome completo</label>
                        <input type="text" id="customer-name" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="customer-cep">CEP</label>
                        <input type="text" id="customer-cep" class="form-input" required>
                        <p class="form-note">O frete será calculado quando o pedido for enviado via WhatsApp.</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="customer-address">Endereço completo</label>
                        <input type="text" id="customer-address" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="delivery-type">Tipo de entrega</label>
                        <select id="delivery-type" class="form-select" required>
                            <option value="">Selecione...</option>
                            <option value="transportadora">Transportadora</option>
                            <option value="excursões">Excursões</option>
                            <option value="uber">Uber</option>
                            <option value="correio">Correio</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="customer-phone">Telefone</label>
                        <input type="tel" id="customer-phone" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Forma de pagamento</label>
                        <p>Pagamentos apenas via PIX</p>
                    </div>
                    
                    <button type="submit" class="submit-order-btn">Enviar Pedido via WhatsApp</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Painel de administrador -->
    <div class="admin-panel" id="admin-panel">
        <div class="container">
            <div class="admin-header">
                <h1 class="admin-title">Painel Administrativo</h1>
                <button class="admin-logout" id="admin-logout">Sair</button>
            </div>
            
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="config">Configurações</div>
                <div class="admin-tab" data-tab="products">Produtos</div>
                <div class="admin-tab" data-tab="inventory">Estoque</div>
            </div>
            
            <!-- Mensagens -->
            <div class="message" id="admin-message"></div>
            
            <!-- Configurações -->
            <div class="admin-content active" id="config-content">
                <div class="admin-form">
                    <h3>Configurações do Site</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="site-logo-input">Logo do Site</label>
                        <input type="file" id="site-logo-input" accept="image/*">
                        <p class="form-note">Ou insira a URL da imagem:</p>
                        <input type="text" id="site-logo-url" class="form-input" placeholder="URL da logo">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="primary-color">Cor Primária</label>
                        <div class="color-picker">
                            <input type="color" id="primary-color" class="color-input" value="#e91e63">
                            <input type="text" id="primary-color-hex" class="form-input" value="#e91e63">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="secondary-color">Cor Secundária</label>
                        <div class="color-picker">
                            <input type="color" id="secondary-color" class="color-input" value="#9c27b0">
                            <input type="text" id="secondary-color-hex" class="form-input" value="#9c27b0">
                        </div>
                    </div>
                    
                    <h3>Informações de Contato</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="footer-phone-input">Telefone</label>
                        <input type="text" id="footer-phone-input" class="form-input" placeholder="(11) 99999-9999">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="footer-email-input">Email</label>
                        <input type="email" id="footer-email-input" class="form-input" placeholder="contato@exemplo.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="footer-instagram-input">Instagram</label>
                        <input type="text" id="footer-instagram-input" class="form-input" placeholder="URL do Instagram">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="footer-facebook-input">Facebook</label>
                        <input type="text" id="footer-facebook-input" class="form-input" placeholder="URL do Facebook">
                    </div>
                    
                    <button class="admin-btn" id="save-config-btn">Salvar Configurações</button>
                </div>
            </div>
            
            <!-- Produtos -->
            <div class="admin-content" id="products-content">
                <div class="admin-form">
                    <h3>Adicionar Novo Produto</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="product-name">Nome do Produto</label>
                        <input type="text" id="product-name" class="form-input" placeholder="Ex: Top Fitness Básico">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="product-price">Preço (R$)</label>
                        <input type="number" id="product-price" class="form-input" placeholder="Ex: 49.90" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="product-category">Categoria</label>
                        <select id="product-category" class="form-select">
                            <option value="conjuntos">Conjuntos</option>
                            <option value="macaquinhos">Macaquinhos</option>
                            <option value="tops">Tops</option>
                            <option value="shorts">Shorts</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Imagens do Produto</label>
                        <p class="form-note">Faça upload das imagens ou insira as URLs:</p>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label class="form-label" for="product-image1">Imagem 1</label>
                                <input type="file" id="product-image1" accept="image/*">
                                <input type="text" id="product-image1-url" class="form-input" placeholder="URL da imagem 1">
                            </div>
                            
                            <div class="form-col">
                                <label class="form-label" for="product-image2">Imagem 2</label>
                                <input type="file" id="product-image2" accept="image/*">
                                <input type="text" id="product-image2-url" class="form-input" placeholder="URL da imagem 2">
                            </div>
                            
                            <div class="form-col">
                                <label class="form-label" for="product-image3">Imagem 3</label>
                                <input type="file" id="product-image3" accept="image/*">
                                <input type="text" id="product-image3-url" class="form-input" placeholder="URL da imagem 3">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Cores e Estoque Inicial</label>
                        <div id="color-fields">
                            <!-- Campos de cor serão adicionados dinamicamente -->
                        </div>
                        <button type="button" class="admin-btn secondary" id="add-color-btn">Adicionar Cor</button>
                    </div>
                    
                    <button class="admin-btn" id="add-product-btn">Adicionar Produto</button>
                </div>
                
                <h3>Produtos Cadastrados</h3>
                <div id="products-list">
                    <!-- Lista de produtos será carregada dinamicamente -->
                </div>
            </div>
            
            <!-- Estoque -->
            <div class="admin-content" id="inventory-content">
                <h3>Controle de Estoque</h3>
                <p>Atualize as quantidades em estoque para cada produto e cor:</p>
                
                <div class="loading" id="inventory-loading">
                    <div class="spinner"></div>
                    <p>Carregando estoque...</p>
                </div>
                
                <table class="inventory-table" id="inventory-table">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th>Cor</th>
                            <th>Estoque Atual</th>
                            <th>Nova Quantidade</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-tbody">
                        <!-- Dados de estoque serão carregados dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Login -->
    <div class="login-modal" id="login-modal">
        <div class="login-content">
            <h2 class="login-title">Acesso Administrativo</h2>
            
            <div class="message" id="login-message"></div>
            
            <div class="form-group">
                <label class="form-label" for="admin-email">Email</label>
                <input type="email" id="admin-email" class="form-input" placeholder="seu@email.com">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="admin-password">Senha</label>
                <input type="password" id="admin-password" class="form-input" placeholder="Sua senha">
            </div>
            
            <button class="login-btn" id="login-btn">Entrar</button>
        </div>
    </div>
    
    <!-- Loading geral -->
    <div class="loading" id="global-loading">
        <div class="spinner"></div>
        <p>Carregando...</p>
    </div>

    <!-- Firebase e configuração do app -->
    <script>
      // Configuração do Firebase (SEM Storage)
const firebaseConfig = {
    apiKey: "AIzaSyAn5SPhZJPqR6IdQecnFnMwLdDm3efy4ko",
    authDomain: "hellen-moda-fitnes.firebaseapp.com",
    projectId: "hellen-moda-fitnes",
    storageBucket: "hellen-moda-fitnes.firebasestorage.app", // Pode manter, mas não usaremos
    messagingSenderId: "998940228851",
    appId: "1:998940228851:web:d4e8d3ac366c26fe9e4b86"
};

// Inicializar Firebase (SEM Storage)
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
// SEM storage - removemos a inicialização do Storage

// Variáveis globais
let currentUser = null;
let products = [];
let cart = [];
let currentProduct = null;
let currentImageIndex = 0;
let reservationTimers = {};

// Elementos DOM (COMPLETO - mantido igual)
const elements = {
    // Header
    siteLogo: document.getElementById('site-logo'),
    homeBtn: document.getElementById('home-btn'),
    menuBtn: document.getElementById('menu-btn'),
    cartBtn: document.getElementById('cart-btn'),
    cartBadge: document.getElementById('cart-badge'),
    floatingCartBtn: document.getElementById('floating-cart-btn'),
    floatingCartBadge: document.getElementById('floating-cart-badge'),
    
    // Menu
    menuOverlay: document.getElementById('menu-overlay'),
    sideMenu: document.getElementById('side-menu'),
    menuClose: document.getElementById('menu-close'),
    menuList: document.querySelectorAll('.menu-list a'),
    
    // Conteúdo
    categoryTitle: document.getElementById('category-title'),
    productsGrid: document.getElementById('products-grid'),
    
    // Modal de produto
    productModal: document.getElementById('product-modal'),
    productModalClose: document.getElementById('product-modal-close'),
    productSlider: document.getElementById('product-slider'),
    sliderNav: document.getElementById('slider-nav'),
    modalProductName: document.getElementById('modal-product-name'),
    modalProductPrice: document.getElementById('modal-product-price'),
    colorOptions: document.getElementById('color-options'),
    addToCartBtn: document.getElementById('add-to-cart-btn'),
    
    // Carrinho
    cartModal: document.getElementById('cart-modal'),
    cartClose: document.getElementById('cart-close'),
    cartItems: document.getElementById('cart-items'),
    cartTotal: document.getElementById('cart-total'),
    checkoutBtn: document.getElementById('checkout-btn'),
    
    // Checkout
    checkoutModal: document.getElementById('checkout-modal'),
    checkoutClose: document.getElementById('checkout-close'),
    checkoutItems: document.getElementById('checkout-items'),
    checkoutTotal: document.getElementById('checkout-total'),
    checkoutForm: document.getElementById('checkout-form'),
    
    // Footer
    footerPhone: document.getElementById('footer-phone'),
    footerEmail: document.getElementById('footer-email'),
    footerInstagram: document.getElementById('footer-instagram'),
    footerFacebook: document.getElementById('footer-facebook'),
    adminAccessLink: document.getElementById('admin-access-link'),
    
    // Painel administrativo
    adminPanel: document.getElementById('admin-panel'),
    adminLogout: document.getElementById('admin-logout'),
    adminTabs: document.querySelectorAll('.admin-tab'),
    adminContents: document.querySelectorAll('.admin-content'),
    adminMessage: document.getElementById('admin-message'),
    
    // Configurações
    siteLogoInput: document.getElementById('site-logo-input'),
    siteLogoUrl: document.getElementById('site-logo-url'),
    primaryColor: document.getElementById('primary-color'),
    primaryColorHex: document.getElementById('primary-color-hex'),
    secondaryColor: document.getElementById('secondary-color'),
    secondaryColorHex: document.getElementById('secondary-color-hex'),
    footerPhoneInput: document.getElementById('footer-phone-input'),
    footerEmailInput: document.getElementById('footer-email-input'),
    footerInstagramInput: document.getElementById('footer-instagram-input'),
    footerFacebookInput: document.getElementById('footer-facebook-input'),
    saveConfigBtn: document.getElementById('save-config-btn'),
    
    // Produtos
    productName: document.getElementById('product-name'),
    productPrice: document.getElementById('product-price'),
    productCategory: document.getElementById('product-category'),
    productImage1: document.getElementById('product-image1'),
    productImage1Url: document.getElementById('product-image1-url'),
    productImage2: document.getElementById('product-image2'),
    productImage2Url: document.getElementById('product-image2-url'),
    productImage3: document.getElementById('product-image3'),
    productImage3Url: document.getElementById('product-image3-url'),
    colorFields: document.getElementById('color-fields'),
    addColorBtn: document.getElementById('add-color-btn'),
    addProductBtn: document.getElementById('add-product-btn'),
    productsList: document.getElementById('products-list'),
    
    // Estoque
    inventoryLoading: document.getElementById('inventory-loading'),
    inventoryTable: document.getElementById('inventory-table'),
    inventoryTbody: document.getElementById('inventory-tbody'),
    
    // Login
    loginModal: document.getElementById('login-modal'),
    adminEmail: document.getElementById('admin-email'),
    adminPassword: document.getElementById('admin-password'),
    loginBtn: document.getElementById('login-btn'),
    loginMessage: document.getElementById('login-message'),
    
    // Loading
    globalLoading: document.getElementById('global-loading')
};

// ========== FUNÇÕES DE RESERVA DE ESTOQUE (MODIFICADAS) ==========

// Reservar estoque temporariamente
function reserveStock(productId, colorName, quantity) {
    return db.collection('products').doc(productId).get()
        .then(doc => {
            if (doc.exists) {
                const product = doc.data();
                const updatedColors = product.colors.map(color => {
                    if (color.name === colorName) {
                        // Calcular estoque disponível (total - reservado)
                        const availableStock = color.stock - (color.reserved || 0);
                        if (availableStock < quantity) {
                            throw new Error(`Estoque insuficiente para ${colorName}. Disponível: ${availableStock}`);
                        }
                        
                        // Atualizar quantidade reservada
                        return {
                            ...color,
                            reserved: (color.reserved || 0) + quantity
                        };
                    }
                    return color;
                });
                
                return db.collection('products').doc(productId).update({
                    colors: updatedColors
                });
            }
        });
}

// Liberar estoque reservado
function releaseStock(productId, colorName, quantity) {
    return db.collection('products').doc(productId).get()
        .then(doc => {
            if (doc.exists) {
                const product = doc.data();
                const updatedColors = product.colors.map(color => {
                    if (color.name === colorName) {
                        return {
                            ...color,
                            reserved: Math.max(0, (color.reserved || 0) - quantity)
                        };
                    }
                    return color;
                });
                
                return db.collection('products').doc(productId).update({
                    colors: updatedColors
                });
            }
        });
}

// Iniciar timer para liberar reserva expirada
function startReservationTimer(productId, colorName, quantity, itemId) {
    const timerKey = `${productId}_${colorName}_${itemId}`;
    
    // Cancela timer anterior se existir
    if (reservationTimers[timerKey]) {
        clearTimeout(reservationTimers[timerKey]);
    }
    
    // Novo timer de 15 minutos
    reservationTimers[timerKey] = setTimeout(() => {
        releaseStock(productId, colorName, quantity)
            .then(() => {
                console.log(`Reserva expirada: ${quantity} ${colorName} do produto ${productId}`);
                delete reservationTimers[timerKey];
                loadProducts(); // Atualizar lista de produtos
            })
            .catch(error => {
                console.error('Erro ao liberar reserva expirada:', error);
            });
    }, 15 * 60 * 1000); // 15 minutos
}

// Renovar timer quando usuário interagir com o carrinho
function renewReservationTimer(productId, colorName, quantity, itemId) {
    startReservationTimer(productId, colorName, quantity, itemId);
}

// ========== FUNÇÕES MODIFICADAS (SEM STORAGE) ==========

// Adicionar ao carrinho (MODIFICADA)
function addToCart(product, color, quantity) {
    // Primeiro reserva o estoque
    reserveStock(product.id, color, quantity)
        .then(() => {
            // Criar ID único para este item no carrinho
            const itemId = Date.now().toString();
            
            const existingItemIndex = cart.findIndex(item => 
                item.productId === product.id && item.color === color
            );
            
            if (existingItemIndex > -1) {
                // Atualizar quantidade existente
                cart[existingItemIndex].quantity += quantity;
                cart[existingItemIndex].itemId = itemId;
            } else {
                // Adicionar novo item
                cart.push({
                    itemId: itemId,
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    color: color,
                    quantity: quantity,
                    image: product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/300x300?text=Sem+Imagem'
                });
            }
            
            // Iniciar timer para este item
            startReservationTimer(product.id, color, quantity, itemId);
            
            saveCartToStorage();
            updateCartBadge();
            loadProducts(); // Atualizar estoque exibido
            
            alert('Produto adicionado ao carrinho! Estoque reservado por 15 minutos.');
        })
        .catch(error => {
            alert('Erro: ' + error.message);
        });
}

// Remover do carrinho (MODIFICADA)
function removeFromCart(productId, color) {
    const itemIndex = cart.findIndex(item => 
        item.productId === productId && item.color === color
    );
    
    if (itemIndex > -1) {
        const item = cart[itemIndex];
        
        // Liberar o estoque reservado
        releaseStock(productId, color, item.quantity)
            .then(() => {
                // Remover timer
                const timerKey = `${productId}_${color}_${item.itemId}`;
                if (reservationTimers[timerKey]) {
                    clearTimeout(reservationTimers[timerKey]);
                    delete reservationTimers[timerKey];
                }
                
                // Remover do carrinho
                cart.splice(itemIndex, 1);
                saveCartToStorage();
                updateCartBadge();
                loadProducts(); // Atualizar estoque exibido
                
                if (elements.cartModal.classList.contains('active')) {
                    renderCartItems();
                }
            })
            .catch(error => {
                console.error('Erro ao liberar estoque:', error);
            });
    }
}

// Atualizar quantidade no carrinho (MODIFICADA)
function updateCartQuantity(productId, color, newQuantity, itemId) {
    const itemIndex = cart.findIndex(item => 
        item.productId === productId && item.color === color
    );
    
    if (itemIndex > -1) {
        const oldQuantity = cart[itemIndex].quantity;
        const difference = newQuantity - oldQuantity;
        
        if (difference > 0) {
            // Aumentando quantidade - tentar reservar mais
            return reserveStock(productId, color, difference)
                .then(() => {
                    cart[itemIndex].quantity = newQuantity;
                    saveCartToStorage();
                    updateCartBadge();
                    renewReservationTimer(productId, color, newQuantity, itemId);
                    loadProducts();
                    return true;
                })
                .catch(error => {
                    alert('Erro: ' + error.message);
                    return false;
                });
        } else if (difference < 0) {
            // Diminuindo quantidade - liberar o excesso
            return releaseStock(productId, color, -difference)
                .then(() => {
                    cart[itemIndex].quantity = newQuantity;
                    saveCartToStorage();
                    updateCartBadge();
                    renewReservationTimer(productId, color, newQuantity, itemId);
                    loadProducts();
                    return true;
                })
                .catch(error => {
                    console.error('Erro ao liberar estoque:', error);
                    return false;
                });
        }
        
        return true;
    }
    
    return false;
}

// Adicionar produto (MODIFICADA - SEM UPLOAD DE IMAGENS)
function addProduct() {
    // Coletar dados do formulário
    const productData = {
        name: elements.productName.value,
        price: parseFloat(elements.productPrice.value),
        category: elements.productCategory.value,
        colors: [],
        images: [], // Vamos usar URLs diretamente
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    // Validar dados
    if (!productData.name || !productData.price || productData.price <= 0) {
        showAdminMessage('Preencha todos os campos obrigatórios!', 'error');
        return;
    }
    
    // Coletar cores
    const colorFields = elements.colorFields.querySelectorAll('.form-row');
    colorFields.forEach(field => {
        const name = field.querySelector('.color-name').value;
        const hex = field.querySelector('.color-hex').value;
        const stock = parseInt(field.querySelector('.color-stock').value) || 0;
        
        if (name) {
            productData.colors.push({
                name: name,
                hex: hex,
                stock: stock,
                reserved: 0 // Campo novo para reservas
            });
        }
    });
    
    if (productData.colors.length === 0) {
        showAdminMessage('Adicione pelo menos uma cor!', 'error');
        return;
    }
    
    // Coletar URLs das imagens (SEM UPLOAD - só URLs)
    if (elements.productImage1Url.value) {
        productData.images.push(elements.productImage1Url.value);
    }
    if (elements.productImage2Url.value) {
        productData.images.push(elements.productImage2Url.value);
    }
    if (elements.productImage3Url.value) {
        productData.images.push(elements.productImage3Url.value);
    }
    
    // Se não tiver URLs, usar placeholders
    if (productData.images.length === 0) {
        productData.images = [
            'https://via.placeholder.com/300x300/FF6B6B/FFFFFF?text=' + encodeURIComponent(productData.name.substring(0, 20)),
            'https://via.placeholder.com/300x300/4ECDC4/FFFFFF?text=' + encodeURIComponent(productData.name.substring(0, 20)),
            'https://via.placeholder.com/300x300/45B7D1/FFFFFF?text=' + encodeURIComponent(productData.name.substring(0, 20))
        ];
    }
    
    // Salvar produto no Firestore (SEM storage)
    db.collection('products').add(productData)
        .then(() => {
            showAdminMessage('Produto adicionado com sucesso!', 'success');
            
            // Limpar formulário
            elements.productName.value = '';
            elements.productPrice.value = '';
            elements.productImage1.value = '';
            elements.productImage1Url.value = '';
            elements.productImage2.value = '';
            elements.productImage2Url.value = '';
            elements.productImage3.value = '';
            elements.productImage3Url.value = '';
            elements.colorFields.innerHTML = '';
            
            // Adicionar um campo de cor vazio
            addColorField();
            
            // Recarregar lista de produtos
            loadProducts();
            loadProductsList();
        })
        .catch(error => {
            console.error('Erro ao adicionar produto:', error);
            showAdminMessage('Erro ao adicionar produto: ' + error.message, 'error');
        });
}

// ========== FUNÇÕES DE PRODUTOS (MODIFICADAS) ==========

// Carregar produtos do Firestore
function loadProducts() {
    db.collection('products').orderBy('createdAt', 'desc').limit(50).get()
        .then((querySnapshot) => {
            products = [];
            querySnapshot.forEach((doc) => {
                products.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            renderProducts('all');
        })
        .catch((error) => {
            console.error('Erro ao carregar produtos:', error);
        });
}

// Renderizar produtos na grade
function renderProducts(category) {
    if (!elements.productsGrid) return;
    
    elements.productsGrid.innerHTML = '';
    
    let filteredProducts = products;
    if (category !== 'all') {
        filteredProducts = products.filter(product => product.category === category);
    }
    
    if (filteredProducts.length === 0) {
        elements.productsGrid.innerHTML = '<p>Nenhum produto encontrado.</p>';
        return;
    }
    
    filteredProducts.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        
        const mainImage = product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/300x300?text=Sem+Imagem';
        
        productCard.innerHTML = `
            <div class="product-image">
                <img src="${mainImage}" alt="${product.name}" data-product-id="${product.id}">
            </div>
            <div class="product-thumbnails">
                ${product.images && product.images.length > 0 ? 
                    product.images.slice(0, 3).map((img, index) => 
                        `<img src="${img}" class="thumbnail ${index === 0 ? 'active' : ''}" data-product-id="${product.id}" data-image-index="${index}">`
                    ).join('') 
                    : ''
                }
            </div>
            <div class="product-info">
                <h3 class="product-name">${product.name}</h3>
                <p class="product-price">R$ ${product.price.toFixed(2)}</p>
                <button class="buy-btn" data-product-id="${product.id}">Comprar</button>
            </div>
        `;
        
        elements.productsGrid.appendChild(productCard);
    });
    
    // Adicionar event listeners para as imagens e botões
    setTimeout(() => {
        document.querySelectorAll('.product-image img, .thumbnail').forEach(element => {
            element.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                const imageIndex = this.getAttribute('data-image-index');
                openProductModal(productId, imageIndex ? parseInt(imageIndex) : 0);
            });
        });
        
        document.querySelectorAll('.buy-btn').forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                openProductModal(productId, 0);
            });
        });
    }, 100);
}

// Calcular estoque disponível para exibição
function getAvailableStock(product, colorName) {
    const color = product.colors.find(c => c.name === colorName);
    if (color) {
        return color.stock - (color.reserved || 0);
    }
    return 0;
}

// Abrir modal do produto (MODIFICADA para mostrar estoque disponível)
function openProductModal(productId, imageIndex = 0) {
    currentProduct = products.find(p => p.id === productId);
    currentImageIndex = imageIndex;
    
    if (!currentProduct) return;
    
    elements.modalProductName.textContent = currentProduct.name;
    elements.modalProductPrice.textContent = `R$ ${currentProduct.price.toFixed(2)}`;
    
    // Configurar slider de imagens
    elements.productSlider.innerHTML = '';
    elements.sliderNav.innerHTML = '';
    
    if (currentProduct.images && currentProduct.images.length > 0) {
        currentProduct.images.forEach((image, index) => {
            const slide = document.createElement('img');
            slide.className = 'slider-image';
            slide.src = image;
            elements.productSlider.appendChild(slide);
            
            const dot = document.createElement('div');
            dot.className = `slider-dot ${index === currentImageIndex ? 'active' : ''}`;
            dot.setAttribute('data-slide-index', index);
            elements.sliderNav.appendChild(dot);
            
            dot.addEventListener('click', function() {
                goToSlide(index);
            });
        });
        
        goToSlide(currentImageIndex);
    }
    
    // Configurar opções de cor (MODIFICADA para mostrar estoque disponível)
    elements.colorOptions.innerHTML = '';
    
    if (currentProduct.colors && currentProduct.colors.length > 0) {
        currentProduct.colors.forEach(color => {
            const availableStock = getAvailableStock(currentProduct, color.name);
            
            const colorOption = document.createElement('div');
            colorOption.className = 'color-option';
            
            colorOption.innerHTML = `
                <div class="color-info">
                    <div class="color-sample" style="background-color: ${color.hex || '#cccccc'}"></div>
                    <div>
                        <div class="color-name">${color.name}</div>
                        <div class="color-stock">Disponível: ${availableStock} unidades</div>
                        ${(color.reserved || 0) > 0 ? `<div class="color-reserved" style="font-size: 0.8rem; color: #666;">(${color.reserved} reservadas)</div>` : ''}
                    </div>
                </div>
                <input type="number" class="quantity-input" min="0" max="${availableStock}" value="0" 
                       data-color-name="${color.name}" ${availableStock === 0 ? 'disabled' : ''}>
            `;
            
            elements.colorOptions.appendChild(colorOption);
        });
    }
    
    elements.productModal.classList.add('active');
    
    // Adicionar event listeners para navegação por swipe
    let startX = 0;
    let endX = 0;
    
    elements.productSlider.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
    });
    
    elements.productSlider.addEventListener('touchend', (e) => {
        endX = e.changedTouches[0].clientX;
        handleSwipe();
    });
    
    function handleSwipe() {
        const diff = startX - endX;
        const threshold = 50;
        
        if (Math.abs(diff) > threshold) {
            if (diff > 0 && currentImageIndex < currentProduct.images.length - 1) {
                goToSlide(currentImageIndex + 1);
            } else if (diff < 0 && currentImageIndex > 0) {
                goToSlide(currentImageIndex - 1);
            }
        }
    }
}

// Navegar para um slide específico
function goToSlide(index) {
    if (!currentProduct || !currentProduct.images) return;
    
    currentImageIndex = index;
    const slideWidth = 100 / currentProduct.images.length;
    elements.productSlider.style.transform = `translateX(-${index * slideWidth}%)`;
    
    // Atualizar dots de navegação
    document.querySelectorAll('.slider-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
    });
}

// Fechar modal do produto
function closeProductModal() {
    elements.productModal.classList.remove('active');
    currentProduct = null;
    currentImageIndex = 0;
}

// ========== CARRINHO E CHECKOUT (MODIFICADAS) ==========

// Adicionar produto ao carrinho a partir do modal
function addToCartFromModal() {
    if (!currentProduct) return;
    
    const colorQuantities = [];
    let hasItems = false;
    
    // Coletar quantidades por cor
    document.querySelectorAll('.color-option').forEach(option => {
        const colorName = option.querySelector('.quantity-input').getAttribute('data-color-name');
        const quantity = parseInt(option.querySelector('.quantity-input').value);
        
        if (quantity > 0) {
            colorQuantities.push({
                color: colorName,
                quantity: quantity
            });
            hasItems = true;
        }
    });
    
    if (!hasItems) {
        alert('Selecione pelo menos uma cor e quantidade!');
        return;
    }
    
    // Verificar se há estoque suficiente
    for (const item of colorQuantities) {
        const availableStock = getAvailableStock(currentProduct, item.color);
        if (availableStock < item.quantity) {
            alert(`Estoque insuficiente para a cor ${item.color}! Disponível: ${availableStock}`);
            return;
        }
    }
    
    // Adicionar ao carrinho
    colorQuantities.forEach(item => {
        addToCart(currentProduct, item.color, item.quantity);
    });
    
    // Fechar o modal
    closeProductModal();
}

// Renderizar itens do carrinho
function renderCartItems() {
    if (!elements.cartItems) return;
    
    elements.cartItems.innerHTML = '';
    
    if (cart.length === 0) {
        elements.cartItems.innerHTML = '<p>Seu carrinho está vazio.</p>';
        elements.cartTotal.textContent = 'R$ 0,00';
        return;
    }
    
    let total = 0;
    
    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        
        cartItem.innerHTML = `
            <img src="${item.image}" alt="${item.name}" class="cart-item-image">
            <div class="cart-item-details">
                <div class="cart-item-name">${item.name}</div>
                <div class="cart-item-color">Cor: ${item.color}</div>
                <div class="cart-item-quantity">
                    <button class="quantity-btn minus" data-product-id="${item.productId}" data-color="${item.color}" data-item-id="${item.itemId}">-</button>
                    <span>${item.quantity}</span>
                    <button class="quantity-btn plus" data-product-id="${item.productId}" data-color="${item.color}" data-item-id="${item.itemId}">+</button>
                </div>
                <div class="cart-item-price">R$ ${itemTotal.toFixed(2)}</div>
            </div>
            <button class="cart-remove" data-product-id="${item.productId}" data-color="${item.color}" data-item-id="${item.itemId}">
                <i class="fas fa-trash"></i>
            </button>
        `;
        
        elements.cartItems.appendChild(cartItem);
    });
    
    elements.cartTotal.textContent = `R$ ${total.toFixed(2)}`;
    
    // Adicionar event listeners
    setTimeout(() => {
        document.querySelectorAll('.quantity-btn.minus').forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                const color = this.getAttribute('data-color');
                const itemId = this.getAttribute('data-item-id');
                const item = cart.find(item => item.productId === productId && item.color === color);
                
                if (item && item.quantity > 1) {
                    if (updateCartQuantity(productId, color, item.quantity - 1, itemId)) {
                        renderCartItems();
                    }
                }
            });
        });
        
        document.querySelectorAll('.quantity-btn.plus').forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                const color = this.getAttribute('data-color');
                const itemId = this.getAttribute('data-item-id');
                const item = cart.find(item => item.productId === productId && item.color === color);
                
                if (item) {
                    if (updateCartQuantity(productId, color, item.quantity + 1, itemId)) {
                        renderCartItems();
                    }
                }
            });
        });
        
        document.querySelectorAll('.cart-remove').forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                const color = this.getAttribute('data-color');
                removeFromCart(productId, color);
            });
        });
    }, 100);
}

// Finalizar compra (MODIFICADA)
function submitOrder(e) {
    e.preventDefault();
    
    // Verificar se há itens no carrinho
    if (cart.length === 0) {
        alert('Seu carrinho está vazio!');
        return;
    }
    
    // Verificar pedido mínimo
    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
    if (totalItems < 10) {
        alert('Pedido mínimo é de 10 peças. Seu pedido atual tem ' + totalItems + ' peças.');
        return;
    }
    
    // Coletar dados do formulário
    const formData = {
        name: document.getElementById('customer-name').value,
        cep: document.getElementById('customer-cep').value,
        address: document.getElementById('customer-address').value,
        deliveryType: document.getElementById('delivery-type').value,
        phone: document.getElementById('customer-phone').value
    };
    
    // Validar dados
    if (!formData.name || !formData.cep || !formData.address || !formData.deliveryType || !formData.phone) {
        alert('Por favor, preencha todos os campos obrigatórios!');
        return;
    }
    
    // Verificar estoque final antes de confirmar
    const stockPromises = cart.map(item => {
        return db.collection('products').doc(item.productId).get()
            .then(doc => {
                const product = doc.data();
                const colorData = product.colors.find(c => c.name === item.color);
                const availableStock = colorData.stock - (colorData.reserved || 0);
                
                if (availableStock < item.quantity) {
                    throw new Error(`Estoque insuficiente para ${item.name} (${item.color}). Disponível: ${availableStock}`);
                }
                return true;
            });
    });
    
    Promise.all(stockPromises)
        .then(() => {
            // Converter reservas em vendas definitivas
            const updatePromises = cart.map(item => {
                return db.collection('products').doc(item.productId).get()
                    .then(doc => {
                        const product = doc.data();
                        const updatedColors = product.colors.map(color => {
                            if (color.name === item.color) {
                                return {
                                    ...color,
                                    stock: color.stock - item.quantity,
                                    reserved: Math.max(0, (color.reserved || 0) - item.quantity)
                                };
                            }
                            return color;
                        });
                        
                        return db.collection('products').doc(item.productId).update({
                            colors: updatedColors
                        });
                    });
            });
            
            return Promise.all(updatePromises);
        })
        .then(() => {
            // Limpar todos os timers
            Object.keys(reservationTimers).forEach(key => {
                clearTimeout(reservationTimers[key]);
            });
            reservationTimers = {};
            
            // Montar mensagem para WhatsApp
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let message = `Olá! Gostaria de fazer um pedido:\n\n`;
            
            cart.forEach(item => {
                message += `${item.quantity}x ${item.name} (${item.color}) - R$ ${(item.price * item.quantity).toFixed(2)}\n`;
            });
            
            message += `\nTotal: R$ ${total.toFixed(2)}\n\n`;
            message += `Dados de entrega:\n`;
            message += `Nome: ${formData.name}\n`;
            message += `CEP: ${formData.cep}\n`;
            message += `Endereço: ${formData.address}\n`;
            message += `Tipo de entrega: ${formData.deliveryType}\n`;
            message += `Telefone: ${formData.phone}\n\n`;
            message += `Forma de pagamento: PIX`;
            
            // Abrir WhatsApp
            const encodedMessage = encodeURIComponent(message);
            const whatsappNumber = '5599999999999'; // SUBSTITUA pelo número real
            window.open(`https://wa.me/${whatsappNumber}?text=${encodedMessage}`, '_blank');
            
            // Limpar carrinho
            cart = [];
            saveCartToStorage();
            updateCartBadge();
            loadProducts(); // Atualizar estoque exibido
            
            // Fechar modais
            closeCheckout();
            closeCart();
            
            alert('Pedido enviado com sucesso! Estoque atualizado.');
        })
        .catch(error => {
            alert('Erro ao finalizar pedido: ' + error.message);
        });
}

// ========== PAINEL ADMINISTRATIVO (MODIFICADO) ==========

// Adicionar campo de cor no formulário de produto
function addColorField() {
    const colorField = document.createElement('div');
    colorField.className = 'form-row';
    colorField.innerHTML = `
        <div class="form-col">
            <input type="text" class="form-input color-name" placeholder="Nome da cor">
        </div>
        <div class="form-col">
            <input type="color" class="color-input color-hex" value="#cccccc">
        </div>
        <div class="form-col">
            <input type="number" class="form-input color-stock" placeholder="Estoque" min="0" value="10">
        </div>
        <div class="form-col">
            <button type="button" class="admin-btn secondary remove-color-btn">Remover</button>
        </div>
    `;
    
    elements.colorFields.appendChild(colorField);
    
    // Adicionar event listener para o botão de remover
    colorField.querySelector('.remove-color-btn').addEventListener('click', function() {
        colorField.remove();
    });
}

// Carregar lista de produtos no painel admin
function loadProductsList() {
    if (!elements.productsList) return;
    
    elements.productsList.innerHTML = '<p>Carregando...</p>';
    
    db.collection('products').orderBy('createdAt', 'desc').get()
        .then(querySnapshot => {
            elements.productsList.innerHTML = '';
            
            if (querySnapshot.empty) {
                elements.productsList.innerHTML = '<p>Nenhum produto cadastrado.</p>';
                return;
            }
            
            querySnapshot.forEach(doc => {
                const product = {
                    id: doc.id,
                    ...doc.data()
                };
                
                const productItem = document.createElement('div');
                productItem.className = 'admin-form';
                productItem.innerHTML = `
                    <h4>${product.name} - R$ ${product.price.toFixed(2)}</h4>
                    <p>Categoria: ${product.category}</p>
                    <p>Cores: ${product.colors.map(c => c.name).join(', ')}</p>
                    <button class="admin-btn secondary delete-product-btn" data-product-id="${product.id}">Excluir</button>
                `;
                
                elements.productsList.appendChild(productItem);
            });
            
            // Adicionar event listeners para os botões de excluir
            document.querySelectorAll('.delete-product-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.getAttribute('data-product-id');
                    if (confirm('Tem certeza que deseja excluir este produto?')) {
                        deleteProduct(productId);
                    }
                });
            });
        })
        .catch(error => {
            console.error('Erro ao carregar produtos:', error);
            elements.productsList.innerHTML = '<p>Erro ao carregar produtos.</p>';
        });
}

// ========== FUNÇÕES QUE PERMANECEM IGUAIS ==========

// Inicializar a aplicação
function initApp() {
    if (elements.globalLoading) elements.globalLoading.style.display = 'block';
    
    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            if (elements.adminPanel) elements.adminPanel.style.display = 'none';
            if (elements.loginModal) elements.loginModal.style.display = 'none';
            loadAdminData();
        } else {
            currentUser = null;
            if (elements.adminPanel) elements.adminPanel.style.display = 'none';
            if (elements.loginModal) elements.loginModal.style.display = 'none';
        }
        
        loadSiteConfig();
        loadProducts();
        loadCartFromStorage();
        updateCartBadge();
        
        // Reiniciar timers para itens no carrinho
        cart.forEach(item => {
            startReservationTimer(item.productId, item.color, item.quantity, item.itemId);
        });
        
        setTimeout(() => {
            if (elements.globalLoading) elements.globalLoading.style.display = 'none';
        }, 1000);
    });
    
    setupEventListeners();
}

// Configurar todos os event listeners
function setupEventListeners() {
    // Navegação
    if (elements.homeBtn) elements.homeBtn.addEventListener('click', goToHome);
    if (elements.menuBtn) elements.menuBtn.addEventListener('click', openMenu);
    if (elements.menuClose) elements.menuClose.addEventListener('click', closeMenu);
    if (elements.menuOverlay) elements.menuOverlay.addEventListener('click', closeMenu);
    
    // Carrinho
    if (elements.cartBtn) elements.cartBtn.addEventListener('click', openCart);
    if (elements.floatingCartBtn) elements.floatingCartBtn.addEventListener('click', openCart);
    if (elements.cartClose) elements.cartClose.addEventListener('click', closeCart);
    if (elements.checkoutBtn) elements.checkoutBtn.addEventListener('click', openCheckout);
    
    // Modal de produto
    if (elements.productModalClose) elements.productModalClose.addEventListener('click', closeProductModal);
    if (elements.addToCartBtn) elements.addToCartBtn.addEventListener('click', addToCartFromModal);
    
    // Checkout
    if (elements.checkoutClose) elements.checkoutClose.addEventListener('click', closeCheckout);
    if (elements.checkoutForm) elements.checkoutForm.addEventListener('submit', submitOrder);
    
    // Menu de categorias
    if (elements.menuList) {
        elements.menuList.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const category = this.getAttribute('data-category');
                filterProductsByCategory(category);
                closeMenu();
            });
        });
    }
    
    // Painel administrativo
    if (elements.adminAccessLink) {
        elements.adminAccessLink.addEventListener('click', function(e) {
            e.preventDefault();
            if (elements.loginModal) elements.loginModal.style.display = 'flex';
        });
    }
    
    if (elements.adminLogout) elements.adminLogout.addEventListener('click', logout);
    
    // Tabs do admin
    if (elements.adminTabs) {
        elements.adminTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                switchAdminTab(tabId);
            });
        });
    }
    
    // Configurações de cor
    if (elements.primaryColor && elements.primaryColorHex) {
        elements.primaryColor.addEventListener('input', function() {
            elements.primaryColorHex.value = this.value;
        });
        elements.primaryColorHex.addEventListener('input', function() {
            elements.primaryColor.value = this.value;
        });
    }
    
    if (elements.secondaryColor && elements.secondaryColorHex) {
        elements.secondaryColor.addEventListener('input', function() {
            elements.secondaryColorHex.value = this.value;
        });
        elements.secondaryColorHex.addEventListener('input', function() {
            elements.secondaryColor.value = this.value;
        });
    }
    
    // Botões do admin
    if (elements.saveConfigBtn) elements.saveConfigBtn.addEventListener('click', saveSiteConfig);
    if (elements.addColorBtn) elements.addColorBtn.addEventListener('click', addColorField);
    if (elements.addProductBtn) elements.addProductBtn.addEventListener('click', addProduct);
    
    // Login
    if (elements.loginBtn) elements.loginBtn.addEventListener('click', login);
}

// ... (CONTINUA - PRÓXIMA MENSAGEM COM O RESTO DO CÓDIGO) ...
        // ========== FUNÇÕES DE NAVEGAÇÃO (IGUAIS) ==========

function goToHome() {
    filterProductsByCategory('all');
}

function openMenu() {
    if (elements.sideMenu) elements.sideMenu.classList.add('active');
    if (elements.menuOverlay) elements.menuOverlay.classList.add('active');
}

function closeMenu() {
    if (elements.sideMenu) elements.sideMenu.classList.remove('active');
    if (elements.menuOverlay) elements.menuOverlay.classList.remove('active');
}

function openCart() {
    if (elements.cartModal) {
        elements.cartModal.classList.add('active');
        renderCartItems();
    }
}

function closeCart() {
    if (elements.cartModal) elements.cartModal.classList.remove('active');
}

function openCheckout() {
    if (cart.length === 0) {
        alert('Seu carrinho está vazio!');
        return;
    }
    
    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
    if (totalItems < 10) {
        alert('Pedido mínimo é de 10 peças. Seu pedido atual tem ' + totalItems + ' peças.');
        return;
    }
    
    if (elements.checkoutModal) {
        elements.checkoutModal.classList.add('active');
        renderCheckoutItems();
    }
}

function closeCheckout() {
    if (elements.checkoutModal) elements.checkoutModal.classList.remove('active');
}

// ========== FUNÇÕES AUXILIARES (MODIFICADAS) ==========

// Filtrar produtos por categoria
function filterProductsByCategory(category) {
    let categoryName = 'Todos os produtos';
    
    switch(category) {
        case 'conjuntos': categoryName = 'Conjuntos'; break;
        case 'macaquinhos': categoryName = 'Macaquinhos'; break;
        case 'tops': categoryName = 'Tops'; break;
        case 'shorts': categoryName = 'Shorts'; break;
    }
    
    if (elements.categoryTitle) elements.categoryTitle.textContent = categoryName;
    renderProducts(category);
}

// Renderizar itens no checkout
function renderCheckoutItems() {
    if (!elements.checkoutItems) return;
    
    elements.checkoutItems.innerHTML = '';
    
    if (cart.length === 0) return;
    
    let total = 0;
    
    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        const checkoutItem = document.createElement('div');
        checkoutItem.className = 'checkout-item';
        
        checkoutItem.innerHTML = `
            <span>${item.quantity}x ${item.name} (${item.color})</span>
            <span>R$ ${itemTotal.toFixed(2)}</span>
        `;
        
        elements.checkoutItems.appendChild(checkoutItem);
    });
    
    if (elements.checkoutTotal) elements.checkoutTotal.textContent = `R$ ${total.toFixed(2)}`;
}

// Atualizar badge do carrinho
function updateCartBadge() {
    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
    if (elements.cartBadge) elements.cartBadge.textContent = totalItems;
    if (elements.floatingCartBadge) elements.floatingCartBadge.textContent = totalItems;
}

// Salvar carrinho no sessionStorage
function saveCartToStorage() {
    sessionStorage.setItem('hellen-cart', JSON.stringify(cart));
}

// Carregar carrinho do sessionStorage
function loadCartFromStorage() {
    const savedCart = sessionStorage.getItem('hellen-cart');
    if (savedCart) {
        cart = JSON.parse(savedCart);
    } else {
        cart = [];
    }
}

// ========== PAINEL ADMINISTRATIVO (CONTINUAÇÃO) ==========

// Alternar entre abas do admin
function switchAdminTab(tabId) {
    if (!elements.adminTabs || !elements.adminContents) return;
    
    elements.adminTabs.forEach(tab => tab.classList.remove('active'));
    elements.adminContents.forEach(content => content.classList.remove('active'));
    
    const activeTab = document.querySelector(`.admin-tab[data-tab="${tabId}"]`);
    const activeContent = document.getElementById(`${tabId}-content`);
    
    if (activeTab) activeTab.classList.add('active');
    if (activeContent) activeContent.classList.add('active');
    
    if (tabId === 'inventory') {
        loadInventoryData();
    } else if (tabId === 'products') {
        loadProductsList();
    }
}

// Carregar dados do admin
function loadAdminData() {
    loadSiteConfig();
    loadProductsList();
}

// Carregar configurações do site
function loadSiteConfig() {
    db.collection('siteConfig').doc('config').get()
        .then(doc => {
            if (doc.exists) {
                const config = doc.data();
                
                // Aplicar configurações
                if (config.logo && elements.siteLogo) {
                    elements.siteLogo.src = config.logo;
                }
                
                if (config.primaryColor) {
                    document.documentElement.style.setProperty('--primary-color', config.primaryColor);
                    if (elements.primaryColor) elements.primaryColor.value = config.primaryColor;
                    if (elements.primaryColorHex) elements.primaryColorHex.value = config.primaryColor;
                }
                
                if (config.secondaryColor) {
                    document.documentElement.style.setProperty('--secondary-color', config.secondaryColor);
                    if (elements.secondaryColor) elements.secondaryColor.value = config.secondaryColor;
                    if (elements.secondaryColorHex) elements.secondaryColorHex.value = config.secondaryColor;
                }
                
                // Informações de contato
                if (config.contact) {
                    if (config.contact.phone && elements.footerPhone && elements.footerPhoneInput) {
                        elements.footerPhone.textContent = `Telefone: ${config.contact.phone}`;
                        elements.footerPhoneInput.value = config.contact.phone;
                    }
                    
                    if (config.contact.email && elements.footerEmail && elements.footerEmailInput) {
                        elements.footerEmail.textContent = `Email: ${config.contact.email}`;
                        elements.footerEmailInput.value = config.contact.email;
                    }
                    
                    if (config.contact.instagram && elements.footerInstagram && elements.footerInstagramInput) {
                        elements.footerInstagram.href = config.contact.instagram;
                        elements.footerInstagramInput.value = config.contact.instagram;
                    }
                    
                    if (config.contact.facebook && elements.footerFacebook && elements.footerFacebookInput) {
                        elements.footerFacebook.href = config.contact.facebook;
                        elements.footerFacebookInput.value = config.contact.facebook;
                    }
                }
            }
        })
        .catch(error => {
            console.error('Erro ao carregar configurações:', error);
        });
}

// Salvar configurações do site (MODIFICADA - SEM UPLOAD DE IMAGENS)
function saveSiteConfig() {
    const config = {
        logo: elements.siteLogoUrl ? elements.siteLogoUrl.value : '',
        primaryColor: elements.primaryColor ? elements.primaryColor.value : '#e91e63',
        secondaryColor: elements.secondaryColor ? elements.secondaryColor.value : '#9c27b0',
        contact: {
            phone: elements.footerPhoneInput ? elements.footerPhoneInput.value : '',
            email: elements.footerEmailInput ? elements.footerEmailInput.value : '',
            instagram: elements.footerInstagramInput ? elements.footerInstagramInput.value : '',
            facebook: elements.footerFacebookInput ? elements.footerFacebookInput.value : ''
        },
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    // Se tiver arquivo de logo, usar data URL (SEM storage)
    if (elements.siteLogoInput && elements.siteLogoInput.files.length > 0) {
        const file = elements.siteLogoInput.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            config.logo = e.target.result;
            saveConfigToFirestore(config);
        };
        
        reader.readAsDataURL(file);
    } else {
        saveConfigToFirestore(config);
    }
}

// Salvar configurações no Firestore
function saveConfigToFirestore(config) {
    db.collection('siteConfig').doc('config').set(config, { merge: true })
        .then(() => {
            // Aplicar as novas configurações imediatamente
            if (config.logo && elements.siteLogo) {
                elements.siteLogo.src = config.logo;
            }
            
            if (config.primaryColor) {
                document.documentElement.style.setProperty('--primary-color', config.primaryColor);
            }
            
            if (config.secondaryColor) {
                document.documentElement.style.setProperty('--secondary-color', config.secondaryColor);
            }
            
            if (config.contact) {
                if (config.contact.phone && elements.footerPhone) {
                    elements.footerPhone.textContent = `Telefone: ${config.contact.phone}`;
                }
                
                if (config.contact.email && elements.footerEmail) {
                    elements.footerEmail.textContent = `Email: ${config.contact.email}`;
                }
                
                if (config.contact.instagram && elements.footerInstagram) {
                    elements.footerInstagram.href = config.contact.instagram;
                }
                
                if (config.contact.facebook && elements.footerFacebook) {
                    elements.footerFacebook.href = config.contact.facebook;
                }
            }
            
            showAdminMessage('Configurações salvas com sucesso!', 'success');
        })
        .catch(error => {
            console.error('Erro ao salvar configurações:', error);
            showAdminMessage('Erro ao salvar configurações.', 'error');
        });
}

// Excluir produto
function deleteProduct(productId) {
    db.collection('products').doc(productId).delete()
        .then(() => {
            showAdminMessage('Produto excluído com sucesso!', 'success');
            loadProducts();
            loadProductsList();
        })
        .catch(error => {
            console.error('Erro ao excluir produto:', error);
            showAdminMessage('Erro ao excluir produto.', 'error');
        });
}

// Carregar dados de estoque
function loadInventoryData() {
    if (!elements.inventoryLoading || !elements.inventoryTbody) return;
    
    elements.inventoryLoading.style.display = 'block';
    elements.inventoryTbody.innerHTML = '';
    
    db.collection('products').get()
        .then(querySnapshot => {
            elements.inventoryLoading.style.display = 'none';
            
            if (querySnapshot.empty) {
                elements.inventoryTbody.innerHTML = '<tr><td colspan="5">Nenhum produto cadastrado.</td></tr>';
                return;
            }
            
            querySnapshot.forEach(doc => {
                const product = {
                    id: doc.id,
                    ...doc.data()
                };
                
                product.colors.forEach(color => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.name}</td>
                        <td>
                            <div class="color-info">
                                <div class="color-sample" style="background-color: ${color.hex || '#cccccc'}"></div>
                                <span>${color.name}</span>
                            </div>
                        </td>
                        <td>${color.stock}</td>
                        <td>
                            <input type="number" class="stock-input" min="0" value="${color.stock}" data-product-id="${product.id}" data-color-name="${color.name}">
                        </td>
                        <td>
                            <button class="save-stock-btn" data-product-id="${product.id}" data-color-name="${color.name}">Salvar</button>
                        </td>
                    `;
                    
                    elements.inventoryTbody.appendChild(row);
                });
            });
            
            // Adicionar event listeners para os botões de salvar
            document.querySelectorAll('.save-stock-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.getAttribute('data-product-id');
                    const colorName = this.getAttribute('data-color-name');
                    const newStock = parseInt(this.closest('tr').querySelector('.stock-input').value);
                    
                    updateStockManually(productId, colorName, newStock);
                });
            });
        })
        .catch(error => {
            console.error('Erro ao carregar estoque:', error);
            elements.inventoryLoading.style.display = 'none';
            elements.inventoryTbody.innerHTML = '<tr><td colspan="5">Erro ao carregar estoque.</td></tr>';
        });
}

// Atualizar estoque manualmente (pelo admin)
function updateStockManually(productId, colorName, newStock) {
    db.collection('products').doc(productId).get()
        .then(doc => {
            if (doc.exists) {
                const product = doc.data();
                const updatedColors = product.colors.map(color => {
                    if (color.name === colorName) {
                        return {
                            ...color,
                            stock: newStock
                        };
                    }
                    return color;
                });
                
                return db.collection('products').doc(productId).update({
                    colors: updatedColors
                });
            }
        })
        .then(() => {
            showAdminMessage('Estoque atualizado com sucesso!', 'success');
            loadInventoryData(); // Recarregar a tabela
            loadProducts(); // Atualizar a exibição de produtos
        })
        .catch(error => {
            console.error('Erro ao atualizar estoque:', error);
            showAdminMessage('Erro ao atualizar estoque.', 'error');
        });
}

// Mostrar mensagem no painel admin
function showAdminMessage(message, type) {
    if (!elements.adminMessage) return;
    
    elements.adminMessage.textContent = message;
    elements.adminMessage.className = `message ${type}`;
    elements.adminMessage.style.display = 'block';
    
    setTimeout(() => {
        elements.adminMessage.style.display = 'none';
    }, 5000);
}

// ========== AUTENTICAÇÃO (MODIFICADA) ==========

// Fazer login
function login() {
    if (!elements.adminEmail || !elements.adminPassword) return;
    
    const email = elements.adminEmail.value;
    const password = elements.adminPassword.value;
    
    if (!email || !password) {
        showLoginMessage('Preencha todos os campos!', 'error');
        return;
    }
    
    auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
            currentUser = userCredential.user;
            if (elements.loginModal) elements.loginModal.style.display = 'none';
            if (elements.adminPanel) elements.adminPanel.style.display = 'block';
            loadAdminData();
        })
        .catch((error) => {
            console.error('Erro no login:', error);
            showLoginMessage('Email ou senha incorretos!', 'error');
        });
}

// Fazer logout
function logout() {
    auth.signOut()
        .then(() => {
            currentUser = null;
            if (elements.adminPanel) elements.adminPanel.style.display = 'none';
        })
        .catch((error) => {
            console.error('Erro no logout:', error);
        });
}

// Mostrar mensagem de login
function showLoginMessage(message, type) {
    if (!elements.loginMessage) return;
    
    elements.loginMessage.textContent = message;
    elements.loginMessage.className = `message ${type}`;
    elements.loginMessage.style.display = 'block';
    
    setTimeout(() => {
        elements.loginMessage.style.display = 'none';
    }, 5000);
}

// ========== INICIALIZAÇÃO FINAL ==========

// Adicionar alguns campos de cor iniciais
window.addEventListener('load', function() {
    // Adicionar um campo de cor inicial
    if (typeof addColorField === 'function') {
        addColorField();
    }
    
    // Inicializar a aplicação
    if (typeof initApp === 'function') {
        setTimeout(initApp, 100);
    }
});

// Inicializar quando o DOM estiver pronto
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initApp);
} else {
    initApp();
}
}
    </script>
</body>
</html>
